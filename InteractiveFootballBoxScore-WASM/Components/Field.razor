@using InteractiveFootballBoxScore_WASM.PbpParser.Models
@inject State.GameState GameState
@inject State.PlayState PlayState
<div class="flex flex-row">
    <!-- paint endzone 1 -->
    <svg class="mx-0" style="width:8%;height:100%;">
        <rect width="100%" height="100%" fill="@Home.PrimaryColor" stroke="black" />
    </svg>

    <!-- paint play area -->
    <svg class="mx-0 " style="width:84%;height:100%;">
      <g>
        <rect width="100%" height="100%" fill="green" stroke="black" />
    
        <!-- paint major yardlines -->
        @for(int i=5; i<=95; i+=5)
        {
            <text>
                <text x="@(i-1)%" y="75%" stroke="white">@i</text>
                <text x="@(i-1)%" y="25%" stroke="white">@i</text>
            </text>
            if(i==50)
            {
                <line x1="@i%" y1="0%" x2="@i%" y2="100%" stroke="white" stroke-width="2"/>
                
            }
            else
            {
                <line x1="@i%" y1="0%" x2="@i%" y2="100%" stroke="white"/>  
                <text>@i</text>  
            }
        }

        <!-- paint tick marks -->
        @for(int i=1; i<=99; i+=1)
        {
            <line x1="@i%" y1="0%" x2="@i%" y2="5%" stroke="white" stroke-width="1"/>
            <line x1="@i%" y1="95%" x2="@i%" y2="100%" stroke="white" stroke-width="1"/>
        }

        <!-- draw ball -->
        <ellipse cx="@ballSpot%" cy="50%" rx="@ballWidth%" ry="@ballHeight%" stroke="brown" fill="brown" stroke-width="1"/>
    
      </g>
    </svg>
    <!-- paint endzone 2 -->
    <svg class="mx-0 " style="width:8%;height:100%;">
        <rect width="100%" height="100%" fill="@Away.PrimaryColor" stroke="black" />
    </svg>
</div>

@code {
    // relative ball size on field
    private int ballWidth { get; set; } = 1;
    private int ballHeight { get; set; } = 2;
    private Team Home => GameState.CurrentGame.Home;
    private Team Away => GameState.CurrentGame.Away;
    private int ballSpot
    {
        get
        {
            // set position of ball based on possession
            if (PlayState.CurrentPlay.IsHomePossession)
            {
                return 50 - ballWidth;
            }
            return 50 + ballWidth;
        }
    }

    protected override void OnInitialized()
    {
        PlayState.OnChange += StateHasChanged;
    }
    public void Dispose()
    {
        PlayState.OnChange -= StateHasChanged;
    }
}
